syntax = "proto3";
option java_package = "cool.houge.grpc";
option java_outer_classname = "HybridPb";

import "cool/houge/grpc/auth.proto";
import "cool/houge/grpc/msg.proto";

message ListGidsRequest {
  int32 uid = 1;
}

message ListGidsResponse {
  repeated int32 gids = 1;
}

message AttachRequest {
  string id = 1;
}

message AttachResponse {

  message SubUnsubCommand {
    int32 uid = 1;
    repeated int32 gids = 2;
    // 值为 true 时解除用户与群组的订阅关系
    bool unsub = 9;
  }

  message Command {
    oneof kind {
      SubUnsubCommand sub_unsub = 1;
    }
  }

  message Packet {
    // 转发的数据
    bytes data_bytes = 3;
    // 消息过滤器
    repeated string filters = 9;
  }

  oneof kind {
    Packet packet = 1;
    Command command = 9;
  }
}

service Hybrid {

  //
  rpc Auth(AuthRequest) returns(AuthResponse) {}

  //
  rpc ListGids(ListGidsRequest) returns(ListGidsResponse) {}

  //
  rpc SendToUser(SendMsgRequest) returns(SendMsgResponse) {}

  //
  rpc SendToGroup(SendMsgRequest) returns(SendMsgResponse) {}

  //
  rpc Attach(AttachRequest) returns(AttachResponse) {}
}
