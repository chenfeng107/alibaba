apply plugin: "org.flywaydb.flyway"
apply plugin: "com.bmuschko.docker-remote-api"

configurations {
  flywayMigration
}

flyway {
  url = "jdbc:postgresql://${rootProject.ext.hougeDbHost}:${rootProject.ext.hougeDbPort}/${rootProject.ext.hougeDbName}"
  user = rootProject.ext.hougeDbUser
  password = rootProject.ext.hougeDbPassword
  locations = ["filesystem:postgresql/*.sql"]
  configurations = ["compileClasspath", "flywayMigration"]
}

dependencies {
  // flywaydb 需要使用的依赖 https://flywaydb.org/
  // flywayMigration("mysql:mysql-connector-java:8.0.28")
  flywayMigration("org.postgresql:postgresql:42.3.1")
}

task buildImage(type: com.bmuschko.gradle.docker.tasks.image.DockerBuildImage) {
  group "docker"
  inputDir = projectDir
  images.addAll(
      "kevin70/${rootProject.name}-db-migration:latest".toString(),
      "kevin70/${rootProject.name}-db-migration:${version}".toString()
  )
}
